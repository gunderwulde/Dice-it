/*! main 13-04-2018 */
function Assets(){this.onGlitch=-1!==window.location.href.indexOf("glitch.me");var a=new XMLHttpRequest;a.open("GET",".glitch-assets",!0);var b=this;b.elements=[],void 0!==mainScene&&mainScene.Loader.Push(b),a.onload=function(a){if(200==this.status)for(var c=this.response.split("\n").join(",\n"),d=JSON.parse('{"elems":['+c+"{}]}").elems,e=0;e<d.length;++e)"date"in d[e]&&(null!=b.elements[d[e].name]?d[e].date>b.elements[d[e].name].date&&(b.elements[d[e].name]=d[e]):b.elements[d[e].name]=d[e],b.elements[d[e].name].url=b.elements[d[e].name].url+"?"+Date.parse(b.elements[d[e].name].date));Assets.instance=b,"then"in b&&b.then(b),void 0!==mainScene&&mainScene.Loader.Pop(b)},a.send()}function Camera(){this.name="Camera",this.viewProjectionMatrix=new Matrix4,this.viewMatrix=new Matrix4,this.Position(new Vector3),this.Rotation(new Quaternion),gl.clearColor(0,0,0,0),gl.clearDepth(1),gl.enable(gl.DEPTH_TEST),gl.depthFunc(gl.LEQUAL),this.projectionMatrix=new Matrix4,this.projectionMatrix.perspective(45*Math.PI/180,gl.canvas.clientWidth/gl.canvas.clientHeight,.1,20)}function Color(a,b,c,d){this._r=a||0,this._g=b||0,this._b=c||0,this._a=d||1}function Loader(a,b){this.name="Loader",this.Scene=a,this.OnReady=b,this.Pending=[]}function Matrix4(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function Mesh(a){this.name="Mesh",this.shader=a,this.submeshes=[],this.modelMatrix=new Matrix4,this.normalMatrix=new Matrix4,this.modelViewMatrix=new Matrix4,this.modelViewProyectionMatrix=new Matrix4,this.textures=[],this.Position(0,0,0),this.Rotation(new Quaternion)}function Quad(){this.blurShader=new Shader("Blur.shader",!0);var a=[-1,1,0,-1,-1,0,1,-1,0,1,1,0],b=new Color(1,.26,.26,1),c=new Color(.87,0,0,1),d=[];b.ToArray(d),c.ToArray(d),c.ToArray(d),b.ToArray(d),this.positionBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,this.positionBuffer),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(a),gl.STATIC_DRAW),this.colorBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,this.colorBuffer),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(d),gl.STATIC_DRAW);var e=[3,2,1,1,3,0];this.indexBuffer=gl.createBuffer(),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(e),gl.STATIC_DRAW)}function Quaternion(a,b,c,d){this._x=a||0,this._y=b||0,this._z=c||0,this._w=void 0!==d?d:1}function Results(){this.name="Anim",this.current=null}function Value(){}function Result(){this.currentIndex=0,this.time=0}function Scene(){mainScene=this,this.camera=new Camera,this.name="Scene",this.Entities=[],this.Loader=new Loader(this,this.OnReady),this.blurCleaner=new Quad,this.blur=.5}function Shader(a,b,c){this.name="Shader",this.OnLoad=c,this.Load(a,b)}function Texture(){this.name="Texture"}function Vector3(a,b,c){this._x=a||0,this._y=b||0,this._z=c||0}function main(){const a=document.getElementById("glcanvas");a.width=window.innerWidth,a.height=window.innerHeight,(gl=a.getContext("webgl",{preserveDrawingBuffer:!0})||a.getContext("experimental-webgl",{preserveDrawingBuffer:!0}))&&(scene=new Scene,(new Assets).then=function(a){scene.results=new Results,scene.results.Load(a.getURL("dice.results"),!0);var b=new Shader("Normal.shader",!0);b.then=function(c){dice=scene.CreateMesh(b).Load(a.getURL("DadoAzulRedondeado.mesh"),function(b){var c=new Texture;c.Load(a.getURL("DadoBlanco05.png")),b.textures.push(c),b.normal=new Texture,b.normal.Load(a.getURL("NormalDados.png"))})},scene.Update=function(a){scene.results.Update(a,dice,scene.camera)||(console.log("Finish!!!"),document.getElementById("endRoll").style.display="block")}})}function roll(){document.getElementById("roll").style.display="none",scene.results.Throw(getRandomInt(1,6),finish),rolling=!0}function finish(a){}function showProgress(){document.getElementById("glcanvas").style.display="none",document.getElementById("roll").style.display="none",document.getElementById("progress").style.display="block"}function hideProgress(){document.getElementById("glcanvas").style.display="block",document.getElementById("roll").style.display="block",document.getElementById("progress").style.display="none"}function getRandomInt(a,b){return Math.floor(Math.random()*(b-a+1))+a}Assets.prototype.getURL=function(a){return this.onGlitch?this.elements[a].url:"Assets/"+a},Camera.prototype.Position=function(a){this.position=a,this.dirty=!0},Camera.prototype.Rotation=function(a){this.rotation=a,this.dirty=!0},Camera.prototype.Update=function(){if(this.dirty){var a=this.rotation.ToMatrix(),b=new Matrix4;b.position(this.position.Neg()),this.viewMatrix.multiply(a,b),this.viewProjectionMatrix.multiply(this.projectionMatrix,this.viewMatrix),this.dirty=!1}},Color.prototype.ToArray=function(a){a.push(this._r),a.push(this._g),a.push(this._b),a.push(this._a)},Loader.prototype.Push=function(a){this.Pending.push(a)},Loader.prototype.Pop=function(a){var b=this.Pending.indexOf(a);this.Pending.splice(b,1),0==this.Pending.length&&this.OnReady(this.Scene)},Matrix4.prototype.identity=function(){return this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],this},Matrix4.prototype.copy=function(){for(var a=new Matrix4,b=0;b<16;++b)a.elements[b]=this.elements[b];return a},Matrix4.prototype.rotationEuler=function(a,b,c){var d=this.elements,e=Math.cos(a),f=Math.sin(a),g=Math.cos(b),h=Math.sin(b),i=Math.cos(c),j=Math.sin(c),k=e*i,l=e*j,m=f*i,n=f*j;return d[0]=g*i,d[4]=-g*j,d[8]=h,d[1]=l+m*h,d[5]=k-n*h,d[9]=-f*g,d[2]=n-k*h,d[6]=m+l*h,d[10]=e*g,this},Matrix4.prototype.multiply=function(a,b){var c=a.elements,d=b.elements,e=this.elements,f=c[0],g=c[4],h=c[8],i=c[12],j=c[1],k=c[5],l=c[9],m=c[13],n=c[2],o=c[6],p=c[10],q=c[14],r=c[3],s=c[7],t=c[11],u=c[15],v=d[0],w=d[4],x=d[8],y=d[12],z=d[1],A=d[5],B=d[9],C=d[13],D=d[2],E=d[6],F=d[10],G=d[14],H=d[3],I=d[7],J=d[11],K=d[15];return e[0]=f*v+g*z+h*D+i*H,e[4]=f*w+g*A+h*E+i*I,e[8]=f*x+g*B+h*F+i*J,e[12]=f*y+g*C+h*G+i*K,e[1]=j*v+k*z+l*D+m*H,e[5]=j*w+k*A+l*E+m*I,e[9]=j*x+k*B+l*F+m*J,e[13]=j*y+k*C+l*G+m*K,e[2]=n*v+o*z+p*D+q*H,e[6]=n*w+o*A+p*E+q*I,e[10]=n*x+o*B+p*F+q*J,e[14]=n*y+o*C+p*G+q*K,e[3]=r*v+s*z+t*D+u*H,e[7]=r*w+s*A+t*E+u*I,e[11]=r*x+s*B+t*F+u*J,e[15]=r*y+s*C+t*G+u*K,this},Matrix4.prototype.multiplyVector=function(a){var b=this.elements;return new Vector3(a.x*b[0]+a.y*b[4]+a.z*b[8],a.x*b[1]+a.y*b[5]+a.z*b[9],a.x*b[2]+a.y*b[6]+a.z*b[10])},Matrix4.prototype.transposeMultiplyVector=function(a){var b=this.elements;return new Vector3(a.x*b[0]+a.y*b[1]+a.z*b[2],a.x*b[4]+a.y*b[5]+a.z*b[6],a.x*b[8]+a.y*b[9]+a.z*b[10])},Matrix4.prototype.transpose=function(a){var b=this.elements;return b[0]=a[4],b[1]=a[4],b[2]=a[8],b[4]=a[1],b[5]=a[5],b[6]=a[9],b[8]=a[2],b[9]=a[6],b[10]=a[10],this},Matrix4.prototype.invert=function(a){var b=this.elements,c=a[0],d=a[1],e=a[2],f=a[3],g=a[4],h=a[5],i=a[6],j=a[7],k=a[8],l=a[9],m=a[10],n=a[11],o=a[12],p=a[13],q=a[14],r=a[15],s=c*h-d*g,t=c*i-e*g,u=c*j-f*g,v=d*i-e*h,w=d*j-f*h,x=e*j-f*i,y=k*p-l*o,z=k*q-m*o,A=k*r-n*o,B=l*q-m*p,C=l*r-n*p,D=m*r-n*q,E=s*D-t*C+u*B+v*A-w*z+x*y;return E?(E=1/E,b[0]=(h*D-i*C+j*B)*E,b[1]=(e*C-d*D-f*B)*E,b[2]=(p*x-q*w+r*v)*E,b[3]=(m*w-l*x-n*v)*E,b[4]=(i*A-g*D-j*z)*E,b[5]=(c*D-e*A+f*z)*E,b[6]=(q*u-o*x-r*t)*E,b[7]=(k*x-m*u+n*t)*E,b[8]=(g*C-h*A+j*y)*E,b[9]=(d*A-c*C-f*y)*E,b[10]=(o*w-p*u+r*s)*E,b[11]=(l*u-k*w-n*s)*E,b[12]=(h*z-g*B-i*y)*E,b[13]=(c*B-d*z+e*y)*E,b[14]=(p*t-o*v-q*s)*E,b[15]=(k*v-l*t+m*s)*E,this):null},Matrix4.prototype.position=function(a){var b=this.elements;return b[12]=a._x,b[13]=a._y,b[14]=a._z,this},Matrix4.prototype.scale=function(a){var b=this.elements;return b[0]*=a._x,b[5]*=a._y,b[10]*=a._z,this},Matrix4.prototype.perspective=function(a,b,c,d){var e=this.elements,f=1/Math.tan(a/2),g=1/(c-d);return e[0]=f/b,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=f,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=(c-d)*g,e[11]=1,e[12]=0,e[13]=0,e[14]=2*d*c*g,e[15]=0,this},Matrix4.prototype.fromQuaternion=function(a){var b=this.elements,c=a._x,d=a._y,e=a._z,f=a._w,g=c+c,h=d+d,i=e+e,j=c*g,k=c*h,l=c*i,m=d*h,n=d*i,o=e*i,p=f*g,q=f*h,r=f*i;return b[0]=1-(m+o),b[4]=k-r,b[8]=l+q,b[1]=k+r,b[5]=1-(j+o),b[9]=n-p,b[2]=l-q,b[6]=n+p,b[10]=1-(j+m),b[3]=0,b[7]=0,b[11]=0,b[12]=0,b[13]=0,b[14]=0,b[15]=1,this},Mesh.prototype.Load=function(a,b){var c=new XMLHttpRequest;c.open("GET",a,!0),c.responseType="arraybuffer";var d=this;return mainScene.Loader.Push(d),c.onload=function(a){if(200==this.status){var c=new DataView(this.response),e=[],f=[],g=[],h=[],i=[],j=0,k=c.getUint16(j,!0);j+=2;for(var l=0;l<k;l++)e.push(c.getFloat32(j,!0)),j+=4,e.push(c.getFloat32(j,!0)),j+=4,e.push(c.getFloat32(j,!0)),j+=4;d.positionBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,d.positionBuffer),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(e),gl.STATIC_DRAW);for(var l=0;l<k;l++)f.push(c.getFloat32(j,!0)),j+=4,f.push(c.getFloat32(j,!0)),j+=4,f.push(c.getFloat32(j,!0)),j+=4;d.normalBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,d.normalBuffer),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(f),gl.STATIC_DRAW);for(var l=0;l<k;l++)g.push(c.getFloat32(j,!0)),j+=4,g.push(c.getFloat32(j,!0)),j+=4,g.push(c.getFloat32(j,!0)),j+=4,g.push(c.getFloat32(j,!0)),j+=4;d.tangentsBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,d.tangentsBuffer),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(g),gl.STATIC_DRAW);for(var l=0;l<k;l++){var m=c.getFloat32(j,!0);j+=4;var n=c.getFloat32(j,!0);j+=4,h.push(m),h.push(-n)}d.textureCoordBuffer=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,d.textureCoordBuffer),gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(h),gl.STATIC_DRAW);var o=0,p=c.getUint16(j,!0);j+=2;for(var q=0;q<p;q++){var r=c.getUint16(j,!0);j+=2,d.submeshes.push({offset:o,count:r});for(var l=0;l<r;l++)i.push(c.getUint16(j,!0)),j+=2;o+=r}d.indexBuffer=gl.createBuffer(),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,d.indexBuffer),gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(i),gl.STATIC_DRAW),b(d),mainScene.Loader.Pop(d)}},c.send(),this},Mesh.prototype.Draw=function(a){var b=this.shader;if(b.Use(gl),this.dirty){var c=new Matrix4;c.fromQuaternion(this.rotation);var d=new Matrix4;d.position(this.position),this.modelMatrix.multiply(d,c),this.normalMatrix.fromQuaternion(this.rotation),this.dirty=!1}this.modelViewProyectionMatrix.multiply(a.camera.viewProjectionMatrix,this.modelMatrix),b.setNormalMatrix(this.normalMatrix),b.setModelViewProjectionMatrix(this.modelViewProyectionMatrix),b.setModelMatrix(this.modelMatrix),b.BindBuffers(this),this.normal&&b.UseNormal(this.normal);for(var e=0;e<this.submeshes.length;++e)b.UseTexture(this.textures[e],0),gl.drawElements(gl.TRIANGLES,this.submeshes[e].count,gl.UNSIGNED_SHORT,2*this.submeshes[e].offset)},Mesh.prototype.Position=function(a){this.position=a,this.dirty=!0},Mesh.prototype.Rotation=function(a){this.rotation=a,this.dirty=!0},Quad.prototype.Draw=function(a){this.blurShader.Use(gl),this.blurShader.setAlpha(.15),this.blurShader.BindBuffers(this),gl.enable(gl.BLEND),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),gl.disable(gl.DEPTH_TEST),gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0),gl.enable(gl.DEPTH_TEST),gl.disable(gl.BLEND)},Quaternion.Lerp=function(a,b,c){var d=1-c;return new Quaternion(a._x*d+b._x*c,a._y*d+b._y*c,a._z*d+b._z*c,a._w*d+b._w*c)},Quaternion.prototype.ToMatrix=function(){var a=new Matrix4,b=this._w*this._w,c=this._x*this._x,d=this._y*this._y,e=this._z*this._z,f=1/(c+d+e+b);a.elements[0]=(c-d-e+b)*f,a.elements[5]=(-c+d-e+b)*f,a.elements[10]=(-c-d+e+b)*f;var g=this._x*this._y,h=this._z*this._w;a.elements[4]=2*(g+h)*f,a.elements[1]=2*(g-h)*f;var g=this._x*this._z,h=this._y*this._w;a.elements[8]=2*(g-h)*f,a.elements[2]=2*(g+h)*f;var g=this._y*this._z,h=this._x*this._w;return a.elements[9]=2*(g+h)*f,a.elements[6]=2*(g-h)*f,a},Results.prototype.Load=function(a,b,c){var d=new XMLHttpRequest;null!=b&&(a+="?_="+(new Date).getTime()),d.open("GET",a,!0),d.responseType="arraybuffer";var e=this;mainScene.Loader.Push(e),d.onload=function(a){if(200==this.status){var b=new DataView(this.response),d=0;e.valores=[];for(var f=0;f<6;f++){var g={count:b.getUint16(d,!0),result:[]};d+=2,e.valores.push(g);for(var h=0;h<e.valores[f].count;h++)e.valores[f].result[h]=new Result,d=e.valores[f].result[h].Load(b,d)}void 0!=c&&c(e),mainScene.Loader.Pop(e)}},d.onerror=function(a){console.error(d.statusText)},d.send(null)},Results.prototype.Update=function(a,b,c){return!(null!=this.current&&!this.current.Update(a,b,c))||(this.current=null,!1)},Results.prototype.getRandomInt=function(a,b){return Math.floor(Math.random()*(b-a+1))+a},Results.prototype.Throw=function(a){var b=this.getRandomInt(0,4);this.current=this.valores[a-1].result[b],this.current.Reset()},Result.prototype.Reset=function(){this.currentIndex=0,this.time=0},Result.prototype.Load=function(a,b){this.frames=a.getUint16(b,!0),b+=2,this.scaleTime=[],this.dicePosition=[],this.diceRotation=[],this.cameraPosition=[],this.cameraRotation=[];for(var c=0;c<this.frames;c++)this.scaleTime.push(a.getFloat32(b,!0)),b+=4;for(var c=0;c<this.frames;c++)this.dicePosition.push(new Vector3(a.getFloat32(b,!0),a.getFloat32(b+4,!0),a.getFloat32(b+8,!0))),b+=12;for(var c=0;c<this.frames;c++)this.diceRotation.push(new Quaternion(a.getFloat32(b,!0),a.getFloat32(b+4,!0),a.getFloat32(b+8,!0),a.getFloat32(b+12,!0))),b+=16;for(var c=0;c<this.frames;c++)this.cameraPosition.push(new Vector3(a.getFloat32(b,!0),a.getFloat32(b+4,!0),a.getFloat32(b+8,!0))),b+=12;for(var c=0;c<this.frames;c++)this.cameraRotation.push(new Quaternion(a.getFloat32(b,!0),a.getFloat32(b+4,!0),a.getFloat32(b+8,!0),a.getFloat32(b+12,!0))),b+=16;return b},Result.prototype.Update=function(a,b,c){if(this.time+=a*this.scaleTime[this.currentIndex],this.time>.03){if(this.time=0,this.currentIndex>=this.frames-2)return!1;this.currentIndex++}var d=this.time/.03;return c.Position(Vector3.Lerp(this.cameraPosition[this.currentIndex],this.cameraPosition[this.currentIndex+1],d)),c.Rotation(Quaternion.Lerp(this.cameraRotation[this.currentIndex],this.cameraRotation[this.currentIndex+1],d)),b.Position(Vector3.Lerp(this.dicePosition[this.currentIndex],this.dicePosition[this.currentIndex+1],d)),b.Rotation(Quaternion.Lerp(this.diceRotation[this.currentIndex],this.diceRotation[this.currentIndex+1],d)),!0};var mainScene;Scene.prototype.Push=function(a){return this.Entities.push(a),a},Scene.prototype.CreateMesh=function(a){return this.Push(new Mesh(a))},Scene.prototype.Draw=function(){0==this.blur?gl.clear(gl.COLOR_BUFFER_BIT|gl.DEPTH_BUFFER_BIT):(gl.clear(gl.DEPTH_BUFFER_BIT),this.blurCleaner.Draw(this.blur)),this.camera.Update();for(var a=0;a<this.Entities.length;++a)this.Entities[a].Draw(this)},Scene.prototype.OnReady=function(a){function b(d){d*=.001;const e=d-c;c=d,void 0!=a.Update&&a.Update(e),a.Draw(),requestAnimationFrame(b)}var c=0;requestAnimationFrame(b)};var currentShader;Shader.prototype.Load=function(a,b){this.name=a;var c=new XMLHttpRequest;null!=b&&(a+="?_="+(new Date).getTime()),c.open("GET",a,!0),c.responseType="text";var d=this;mainScene.Loader.Push(d),c.onload=function(a){if(200==this.status){var b=this.response.indexOf("[vertex]"),c=this.response.indexOf("[face]"),e=this.response.substring(b+8,c),f=this.response.substring(c+6);d.Init(e,f),void 0!=d.then&&d.then(d),mainScene.Loader.Pop(d)}},c.send()},Shader.prototype.Init=function(a,b){const c=this.LoadShader(gl.VERTEX_SHADER,a),d=this.LoadShader(gl.FRAGMENT_SHADER,b);if(this.shaderProgram=gl.createProgram(),gl.attachShader(this.shaderProgram,c),gl.attachShader(this.shaderProgram,d),gl.linkProgram(this.shaderProgram),!gl.getProgramParameter(this.shaderProgram,gl.LINK_STATUS))return alert("Unable to initialize the shader program: "+gl.getProgramInfoLog(this.shaderProgram)),null;this.attribLocations={vertexPosition:gl.getAttribLocation(this.shaderProgram,"aVertexPosition"),vertexNormal:gl.getAttribLocation(this.shaderProgram,"aVertexNormal"),textureCoord:gl.getAttribLocation(this.shaderProgram,"aTextureCoord"),vertexTangent:gl.getAttribLocation(this.shaderProgram,"aVertexTangent"),vertexColor:gl.getAttribLocation(this.shaderProgram,"aVertexColor")},this.uniformLocations={modelMatrix:gl.getUniformLocation(this.shaderProgram,"uModelMatrix"),modelViewProjectionMatrix:gl.getUniformLocation(this.shaderProgram,"uModelViewProjectionMatrix"),normalMatrix:gl.getUniformLocation(this.shaderProgram,"uNormalMatrix"),uSampler:gl.getUniformLocation(this.shaderProgram,"uSampler"),uNormalSampler:gl.getUniformLocation(this.shaderProgram,"uNormalSampler"),alpha:gl.getUniformLocation(this.shaderProgram,"Alpha")}},Shader.prototype.Use=function(){currentShader!=this&&(gl.useProgram(this.shaderProgram),currentShader=this)},Shader.prototype.UseTexture=function(a){void 0!=a&&(this.Use(),gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,a.texture),gl.uniform1i(this.uniformLocations.uSampler,0))},Shader.prototype.UseNormal=function(a){void 0!=a&&(this.Use(),gl.activeTexture(gl.TEXTURE1),gl.bindTexture(gl.TEXTURE_2D,a.texture),gl.uniform1i(this.uniformLocations.uNormalSampler,1))},Shader.prototype.LoadShader=function(a,b){const c=gl.createShader(a);return gl.shaderSource(c,b),gl.compileShader(c),gl.getShaderParameter(c,gl.COMPILE_STATUS)?c:(alert("An error occurred compiling the shaders: "+gl.getShaderInfoLog(c)),gl.deleteShader(c),null)},Shader.prototype.setModelViewProjectionMatrix=function(a){this.Use(),gl.uniformMatrix4fv(this.uniformLocations.modelViewProjectionMatrix,!1,a.elements)},Shader.prototype.setModelMatrix=function(a){this.Use(),-1!=this.uniformLocations.modelMatrix&&gl.uniformMatrix4fv(this.uniformLocations.modelMatrix,!1,a.elements)},Shader.prototype.setNormalMatrix=function(a){this.Use(),gl.uniformMatrix4fv(this.uniformLocations.normalMatrix,!1,a.elements)},Shader.prototype.BindBuffers=function(a){this.Use(),-1!=this.attribLocations.vertexPosition&&(gl.bindBuffer(gl.ARRAY_BUFFER,a.positionBuffer),gl.vertexAttribPointer(this.attribLocations.vertexPosition,3,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(this.attribLocations.vertexPosition)),-1!=this.attribLocations.vertexNormal&&(gl.bindBuffer(gl.ARRAY_BUFFER,a.normalBuffer),gl.vertexAttribPointer(this.attribLocations.vertexNormal,3,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(this.attribLocations.vertexNormal)),-1!=this.attribLocations.vertexTangent&&(gl.bindBuffer(gl.ARRAY_BUFFER,a.tangentsBuffer),gl.vertexAttribPointer(this.attribLocations.vertexTangent,4,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(this.attribLocations.vertexTangent)),-1!=this.attribLocations.textureCoord&&(gl.bindBuffer(gl.ARRAY_BUFFER,a.textureCoordBuffer),gl.vertexAttribPointer(this.attribLocations.textureCoord,2,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(this.attribLocations.textureCoord)),-1!=this.attribLocations.vertexColor&&(gl.bindBuffer(gl.ARRAY_BUFFER,a.colorBuffer),gl.vertexAttribPointer(this.attribLocations.vertexColor,4,gl.FLOAT,!1,0,0),gl.enableVertexAttribArray(this.attribLocations.vertexColor)),gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,a.indexBuffer)},Shader.prototype.setAlpha=function(a){this.Use(),gl.uniform1f(this.uniformLocations.alpha,a)},Texture.prototype.Load=function(a,b){this.texture=gl.createTexture(),gl.bindTexture(gl.TEXTURE_2D,this.texture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array([0,0,255,255]));const c=new Image;c.setAttribute("crossorigin","anonymous");var d=this;mainScene.Loader.Push(d),c.onload=function(){gl.bindTexture(gl.TEXTURE_2D,d.texture),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,c),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR_MIPMAP_LINEAR),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR),d.isPowerOf2(c.width)&&d.isPowerOf2(c.height)?gl.generateMipmap(gl.TEXTURE_2D):(gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE),gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR)),void 0!=b&&b(d),mainScene.Loader.Pop(d)},c.src=a},Texture.prototype.isPowerOf2=function(a){return 0==(a&a-1)},Vector3.Lerp=function(a,b,c){var d=1-c;return new Vector3(a._x*d+b._x*c,a._y*d+b._y*c,a._z*d+b._z*c)},Vector3.prototype.Neg=function(){return new Vector3(-this._x,-this._y,-this._z)};var dice,gl,scene;